<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gesti√≥n de Usuarios - Inventario INA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    body, html { margin:0; padding:0; width:100%; min-height:100vh; font-family: 'Segoe UI',sans-serif; background:url("/imagenes/n3.jpg") no-repeat center center fixed; background-size:cover; display:flex; flex-direction:column; }
    #particles-js { position: fixed; width:100%; height:100%; top:0; left:0; z-index:0; }

    .main-container { flex:1; display:flex; justify-content:center; align-items:flex-start; padding: 20px; z-index:1; position: relative; }
    .usuarios-container { background: rgba(255,255,255,0.25); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; max-width: 900px; width: 100%; box-shadow: 0 8px 20px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); animation: fadeIn 0.8s ease-out; }

    h1, h2 { color: #EDA232; text-align:center; margin-bottom: 20px; }
    label { font-weight: bold; color: #EDA232; margin-top:10px; display:block; }
    .form-control, select { border-radius:10px; margin-bottom: 10px; }
    .form-control:focus, select:focus { box-shadow:0 0 8px #D1903F; border-color:#E68C1C; outline:none; }
    .btn-primary { background-color: #EDA232 !important; border:2px solid #F0AA11 !important; border-radius:50px; padding:8px 15px; font-weight:500; transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s; }
    .btn-primary:hover { transform: scale(1.03); background-color: #CC8023 !important; box-shadow:0 0 8px rgba(239,187,117,0.8); }

  




    table { width:100%; border-collapse: collapse; margin-top: 20px; background: rgba(255,255,255,0.85); border-radius:10px; overflow:hidden; }
    th, td { padding:10px; text-align:center; border-bottom:1px solid #EDA232; }
    th { background-color: rgba(237,162,50,0.8); color:white; }

    a.volver { display:inline-block; margin-top:15px; color:#EDA232; text-decoration:none; font-weight:bold; }
    a.volver:hover { color:#CC8023; }

    .alert { margin-top: 10px; }
    footer { background: rgba(0,0,0,0.5); color:white; padding:12px 0; text-align:center; font-size:0.85rem; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>

  <div id="particles-js"></div>

  <div class="main-container">
    <div class="usuarios-container">
      <h1>üë• Gesti√≥n de Usuarios</h1>

      <div class="text-center mb-3">
        Usuario logueado: <span style="color:white; font-weight:500;"><%= user.nombre %> (<%= user.rol %>)</span>
      </div>

      <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger text-center"><%= error %></div>
      <% } %>
      <% if (typeof success !== 'undefined' && success) { %>
        <div class="alert alert-success text-center"><%= success %></div>
      <% } %>

      <h2>Registrar nuevo usuario</h2>
      <form action="/usuarios" method="POST">
        <label>Nombre:</label>
        <input type="text" class="form-control" name="nombre" required>

        <label>Usuario:</label>
        <input type="text" class="form-control" name="usuario" required>

        <label>Contrase√±a:</label>
        <input type="text" class="form-control" name="contrasena" required>

        <label>Rol:</label>
        <select name="rol" class="form-control" required>
          <option value="docente">Docente</option>
          <option value="estudiante">Estudiante</option>
        </select>

        <button type="submit" class="btn btn-primary">Crear Usuario</button>
      </form>

      <h2>Lista de Usuarios</h2>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Usuario</th>
              <th>Rol</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% usuarios.forEach(u => { %>
              <tr>
                <td><%= u.id %></td>
                <td><%= u.nombre %></td>
                <td><%= u.usuario %></td>
                <td><%= u.rol %></td>
                <td>
                  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#eliminarModal" data-id="<%= u.id %>" data-nombre="<%= u.nombre %>">Eliminar</button>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div class="text-center">
        <a href="/" class="volver">‚¨Ö Volver al men√∫ principal</a>
      </div>
    </div>
  </div>

  <!-- Modal Eliminar Usuario -->
  <div class="modal fade" id="eliminarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="eliminarForm" method="POST" action="">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Eliminar Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>‚ö†Ô∏è ¬øDeseas eliminar al usuario <strong><span id="modalUsuarioNombre"></span></strong>? Esta acci√≥n no se puede deshacer.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-danger">Eliminar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <footer>&copy; 2025 Instituto Nuevo Amanecer - Todos los derechos reservados</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    particlesJS("particles-js", {
      "particles": {"number":{"value":40},"color":{"value":"#FFD966"},"shape":{"type":"circle"},"opacity":{"value":0.7},"size":{"value":4},"line_linked":{"enable":true,"distance":120,"color":"#ffffff","opacity":0.9,"width":1.5},"move":{"enable":true,"speed":1}},
      "interactivity":{"events":{"onhover":{"enable":true,"mode":"repulse"},"onclick":{"enable":true,"mode":"push"}}},"retina_detect":true
    });

    const eliminarModal = document.getElementById('eliminarModal');
    eliminarModal.addEventListener('show.bs.modal', event => {
      const button = event.relatedTarget;
      const id = button.getAttribute('data-id');
      const nombre = button.getAttribute('data-nombre');

      document.getElementById('modalUsuarioNombre').textContent = nombre;
      document.getElementById('eliminarForm').action = '/usuarios/eliminar/' + id;
    });
  </script>
</body>
</html>
